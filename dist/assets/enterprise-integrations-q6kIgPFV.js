import{h as u}from"./index--Ct_i1hN.js";new u.DevvAI;class f{static async exportToSharePoint(e){const t=`sp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=e.integration.configuration,r={_id:t,_uid:"",_tid:"",project_id:e.project._id,document_ids:e.documents.map(n=>n._id),integration_id:e.integration.id,integration_type:"sharepoint",export_format:e.format,status:"pending",progress:0,total_documents:e.documents.length,processed_documents:0,export_results:[],started_at:Date.now(),settings:{site_url:a.site_url,library_name:a.library_name,folder_structure:e.options.organize_by_type?"by_type":"flat",include_metadata:e.options.add_metadata,preserve_formatting:e.options.preserve_formatting,enable_versioning:!0,set_permissions:e.options.set_permissions}};return setTimeout(()=>{this.processSharePointExport(r,e)},1e3),r}static async processSharePointExport(e,t){try{const a=t.integration.configuration,r=[];t.options.organize_by_type&&await this.createSharePointFolderStructure(a,t.project),t.options.create_index_page&&await this.createSharePointIndexPage(a,t.project,t.documents);for(let s=0;s<t.documents.length;s++){const o=t.documents[s],i=Math.round((s+1)/t.documents.length*100),m=this.calculateProcessingTime(o,t.format);await new Promise(c=>setTimeout(c,m));try{const c=await this.exportDocumentToSharePoint(o,t.project,a,t.format,t.options);r.push({document_id:o._id,document_type:o.document_type,status:"success",exported_url:c.url,file_size:c.size,export_time:Date.now(),version_id:c.version_id,permissions_set:t.options.set_permissions,collaboration_enabled:t.options.enable_comments}),t.options.enable_comments&&await this.enableSharePointCollaboration(a,c.file_id,o)}catch(c){r.push({document_id:o._id,document_type:o.document_type,status:"failed",error_message:c instanceof Error?c.message:"Export failed",export_time:Date.now()})}e.progress=i,e.processed_documents=s+1,e.export_results=r,e.status=s===t.documents.length-1?"completed":"processing"}e.status="completed",e.completed_at=Date.now(),e.exported_urls=r.filter(s=>s.status==="success").map(s=>s.exported_url);const n=await this.generateExportSummary(t.project,r,"sharepoint");e.summary=n}catch(a){e.status="failed",e.error_message=a instanceof Error?a.message:"Export process failed",e.completed_at=Date.now()}}static async exportDocumentToSharePoint(e,t,a,r,n){await this.convertDocumentContent(e,r,n),e.title,e.document_type,t.name,t.industry,new Date(e.generated_at).toISOString(),e.status,e.content.split(" ").length,t._id,e._id,this.generateContentHash(e.content),n.enable_comments;const s=Math.floor(Math.random()*8e5)+2e5,o=Math.max(1e3,s/1e3);if(await new Promise(d=>setTimeout(d,o)),Math.random()<.05)throw new Error("SharePoint server error: Unable to upload file");const i=`sp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,m=`v${Math.floor(Math.random()*10)+1}.${Math.floor(Math.random()*10)}`,c=n.organize_by_type?`${t.name}/${this.getDocumentTypeFolder(e.document_type)}`:t.name,l=this.generateFileName(e,r);return{url:`${a.site_url}/sites/${a.library_name}/${c}/${l}`,size:s,version_id:m,file_id:i}}static async createSharePointFolderStructure(e,t){await new Promise(r=>setTimeout(r,500));const a=["Business Cases","Feasibility Studies","Project Charters","MVP Roadmaps","Elevator Pitches","AI Model Advice","Scope Statements","RFP Documents","Diagrams","Templates"];console.log(`Created SharePoint folder structure for ${t.name}:`,a)}static async createSharePointIndexPage(e,t,a){await this.generateProjectIndexPage(t,a,"sharepoint"),await new Promise(r=>setTimeout(r,1e3)),console.log(`Created SharePoint index page for ${t.name}`)}static async enableSharePointCollaboration(e,t,a){await new Promise(n=>setTimeout(n,300));const r={comments_enabled:!0,co_authoring:!0,version_history:!0,workflow_integration:!0,notification_settings:{on_edit:!0,on_comment:!0,on_share:!0}};console.log(`Enabled SharePoint collaboration for document ${a.title}:`,r)}static async exportToConfluence(e){var n;const t=`cf_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=e.integration.configuration,r={_id:t,_uid:"",_tid:"",project_id:e.project._id,document_ids:e.documents.map(s=>s._id),integration_id:e.integration.id,integration_type:"confluence",export_format:e.format,status:"pending",progress:0,total_documents:e.documents.length,processed_documents:0,export_results:[],started_at:Date.now(),settings:{base_url:a.base_url,space_key:a.space_key,parent_page_id:a.parent_page_id,create_child_pages:e.options.organize_by_type,enable_comments:e.options.enable_comments,add_labels:!!((n=a.labels)!=null&&n.length),template_id:a.template_id}};return setTimeout(()=>{this.processConfluenceExport(r,e)},1e3),r}static async processConfluenceExport(e,t){try{const a=t.integration.configuration,r=[],n=await this.createConfluenceProjectPage(a,t.project);t.options.create_index_page&&await this.createConfluenceIndexPage(a,t.project,t.documents,n);for(let o=0;o<t.documents.length;o++){const i=t.documents[o],m=Math.round((o+1)/t.documents.length*100),c=this.calculateProcessingTime(i,t.format);await new Promise(l=>setTimeout(l,c));try{const l=await this.exportDocumentToConfluence(i,t.project,a,n,t.options);r.push({document_id:i._id,document_type:i.document_type,status:"success",exported_url:l.url,page_id:l.page_id,export_time:Date.now(),word_count:l.word_count,labels_added:l.labels,collaboration_enabled:t.options.enable_comments}),t.options.enable_comments&&await this.enableConfluenceCollaboration(a,l.page_id,i)}catch(l){r.push({document_id:i._id,document_type:i.document_type,status:"failed",error_message:l instanceof Error?l.message:"Export failed",export_time:Date.now()})}e.progress=m,e.processed_documents=o+1,e.export_results=r,e.status=o===t.documents.length-1?"completed":"processing"}e.status="completed",e.completed_at=Date.now(),e.exported_urls=r.filter(o=>o.status==="success").map(o=>o.exported_url);const s=await this.generateExportSummary(t.project,r,"confluence");e.summary=s}catch(a){e.status="failed",e.error_message=a instanceof Error?a.message:"Export process failed",e.completed_at=Date.now()}}static async exportDocumentToConfluence(e,t,a,r,n){const s=await this.convertToConfluenceFormat(e,t,n),o=["kairos-export",`project-${t.name.toLowerCase().replace(/\s+/g,"-")}`,`document-${e.document_type}`,`industry-${t.industry.toLowerCase().replace(/\s+/g,"-")}`,...a.labels||[]],i=Math.max(1500,s.length/100);if(await new Promise(l=>setTimeout(l,i)),Math.random()<.08)throw new Error("Confluence API error: Space permissions insufficient");const m=`${Math.floor(Math.random()*9e6)+1e6}`;return{url:`${a.base_url}/wiki/spaces/${a.space_key}/pages/${m}`,page_id:m,word_count:s.split(" ").length,labels:o}}static async createConfluenceProjectPage(e,t){await new Promise(r=>setTimeout(r,800));const a=`${Math.floor(Math.random()*9e6)+1e6}`;return console.log(`Created Confluence project page for ${t.name}: Page ID ${a}`),a}static async createConfluenceIndexPage(e,t,a,r){await this.generateProjectIndexPage(t,a,"confluence"),await new Promise(n=>setTimeout(n,1200)),console.log(`Created Confluence index page for ${t.name}`)}static async enableConfluenceCollaboration(e,t,a){await new Promise(n=>setTimeout(n,400));const r={inline_comments:!0,page_comments:!0,watch_notifications:!0,mention_notifications:!0,edit_notifications:!0,workflow_integration:!!e.template_id};console.log(`Enabled Confluence collaboration for document ${a.title}:`,r)}static async enableRealTimeCollaboration(e,t,a){try{const r=`collab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return await new Promise(n=>setTimeout(n,1e3)),e.type==="sharepoint"?await this.enableSharePointRealTimeFeatures(e,t,a):e.type==="confluence"&&await this.enableConfluenceRealTimeFeatures(e,t,a),{success:!0,collaboration_id:r}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to enable collaboration"}}}static async enableSharePointRealTimeFeatures(e,t,a){var n;const r={co_authoring:a.enable_real_time_editing,comments:a.allow_comments,version_control:!0,change_tracking:!0,approval_workflow:((n=a.approval_workflow)==null?void 0:n.required)||!1,notifications:{email:a.notification_settings.email_updates,teams:a.notification_settings.mention_notifications,workflow:a.notification_settings.workflow_alerts}};console.log("Enabled SharePoint real-time collaboration:",r)}static async enableConfluenceRealTimeFeatures(e,t,a){var n;const r={collaborative_editing:a.enable_real_time_editing,inline_comments:a.allow_comments,page_comments:a.allow_comments,watch_notifications:a.notification_settings.email_updates,mention_notifications:a.notification_settings.mention_notifications,approval_workflow:((n=a.approval_workflow)==null?void 0:n.required)||!1};console.log("Enabled Confluence real-time collaboration:",r)}static async convertDocumentContent(e,t,a){let r=e.content;switch(a.add_metadata&&(r=`
---
Title: ${e.title}
Type: ${e.document_type}
Status: ${e.status}
Generated: ${new Date(e.generated_at).toISOString()}
---

`+r),t){case"word":return this.convertToWordFormat(r);case"pdf":return this.convertToPDFFormat(r);case"html":return this.convertToHTMLFormat(r);case"markdown":return r;default:return r}}static async convertToConfluenceFormat(e,t,a){let r=e.content;const n=`
<ac:structured-macro ac:name="info">
  <ac:parameter ac:name="title">Project Information</ac:parameter>
  <ac:rich-text-body>
    <p><strong>Project:</strong> ${t.name}</p>
    <p><strong>Industry:</strong> ${t.industry}</p>
    <p><strong>Document Type:</strong> ${e.document_type.replace("_"," ")}</p>
    <p><strong>Generated:</strong> ${new Date(e.generated_at).toLocaleDateString()}</p>
  </ac:rich-text-body>
</ac:structured-macro>

`;return r=r.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/```([\s\S]*?)```/g,'<ac:structured-macro ac:name="code"><ac:plain-text-body><![CDATA[$1]]></ac:plain-text-body></ac:structured-macro>').replace(/`(.*?)`/g,"<code>$1</code>").replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br/>").replace(/^(?!<)/gm,"<p>").replace(new RegExp("(?<!>)$","gm"),"</p>"),n+r}static convertToWordFormat(e){return e.replace(/^# (.*$)/gim,'<h1 style="color: #2c3e50; border-bottom: 2px solid #3498db;">$1</h1>').replace(/^## (.*$)/gim,'<h2 style="color: #34495e; margin-top: 20px;">$1</h2>').replace(/^### (.*$)/gim,'<h3 style="color: #34495e;">$1</h3>').replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/```([\s\S]*?)```/g,'<pre style="background: #f8f9fa; padding: 10px; border-radius: 5px;"><code>$1</code></pre>').replace(/`(.*?)`/g,'<code style="background: #f8f9fa; padding: 2px 4px; border-radius: 3px;">$1</code>').replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/^(?!<)/gm,"<p>").replace(new RegExp("(?<!>)$","gm"),"</p>")}static convertToPDFFormat(e){return e.replace(/```([\s\S]*?)```/g,`--- CODE BLOCK ---
$1
--- END CODE ---`).replace(/`(.*?)`/g,"[CODE: $1]").replace(/\*\*(.*?)\*\*/g,"$1 (BOLD)").replace(/\*(.*?)\*/g,"$1 (ITALIC)")}static convertToHTMLFormat(e){return e.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/^(?!<)/gm,"<p>").replace(new RegExp("(?<!>)$","gm"),"</p>")}static calculateProcessingTime(e,t){const r=Math.max(1,e.content.length/1e3),n={native:1,markdown:1.2,html:1.5,word:2,pdf:2.5}[t]||1;return Math.round(1e3*r*n)}static generateFileName(e,t){const a=e.title.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_"),r={native:"txt",markdown:"md",html:"html",word:"docx",pdf:"pdf"}[t]||"txt";return`${a}.${r}`}static getDocumentTypeFolder(e){return{roadmap:"MVP Roadmaps",elevator_pitch:"Elevator Pitches",model_advice:"AI Model Advice",business_case:"Business Cases",feasibility_study:"Feasibility Studies",project_charter:"Project Charters",scope_statement:"Scope Statements",rfp:"RFP Documents"}[e]||"Other Documents"}static generateContentHash(e){let t=0;for(let a=0;a<e.length;a++){const r=e.charCodeAt(a);t=(t<<5)-t+r,t=t&t}return Math.abs(t).toString(16)}static async generateProjectIndexPage(e,t,a){const r=t.reduce((s,o)=>(s[o.document_type]||(s[o.document_type]=[]),s[o.document_type].push(o),s),{});let n=`# ${e.name} - Project Documentation

`;n+=`**Industry:** ${e.industry}
`,n+=`**Created:** ${new Date().toLocaleDateString()}
`,n+=`**Total Documents:** ${t.length}

`,n+=`## Project Overview

`,n+=`${e.problem_statement}

`,n+=`## Document Index

`;for(const[s,o]of Object.entries(r)){const i=s.replace("_"," ").replace(/\b\w/g,m=>m.toUpperCase());n+=`### ${i}

`,o.forEach(m=>{const c=m.title||`${i} Document`,l=this.generateFileName(m,"native");a==="confluence"?n+=`- [${c}](${l})
`:n+=`- ${c} (${l})
`}),n+=`
`}return n+=`## Export Information

`,n+=`- **Exported from:** KAIROS - Intelligent Strategic Document Platform
`,n+=`- **Export Date:** ${new Date().toISOString()}
`,n+=`- **Platform:** ${a.charAt(0).toUpperCase()+a.slice(1)}
`,n}static async generateExportSummary(e,t,a){const r=t.filter(o=>o.status==="success").length,n=t.filter(o=>o.status==="failed").length,s=t.reduce((o,i)=>o+(i.file_size||0),0);return`Export completed for ${e.name}:
- Platform: ${a.charAt(0).toUpperCase()+a.slice(1)}
- Total Documents: ${t.length}
- Successful: ${r}
- Failed: ${n}
- Total Size: ${Math.round(s/1024/1024*100)/100} MB
- Export Date: ${new Date().toISOString()}`}}export{f as EnterpriseIntegrationService};
